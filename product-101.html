<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cafe de Coral — Menu</title>
  <meta name="description" content="Cafe de Coral — elegant menu with immersive product carousel and cart" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Quattrocento:wght@400;700&display=swap" rel="stylesheet" />
  
  
  
  <style>
    /* === Minimal sanitize subset === */
    *, ::before, ::after { box-sizing: border-box; }
    html { -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; line-height:1.5; word-break:break-word; }
    body { margin:0; font-family: "Quattrocento","Helvetica Neue",Helvetica,Arial, sans-serif; color:#222; background:#faf9f8; }
    img { display:block; max-width:100%; height:auto; border-style:none; vertical-align:middle; }

    /* === Header / nav (keeps original classes but upgraded visuals) === */
    .header {
      width:100%;
      min-width:320px;
      padding:22px 28px;
      position:sticky;
      top:0;
      z-index:40;
      display:flex;
      align-items:center;
      justify-content:space-between;
      background: linear-gradient(180deg, rgba(56,62,99,0.96), rgba(56,62,99,0.88));
      box-shadow: 0 6px 18px rgba(20,20,30,0.18);
      color:#fff;
    }
    .header-Logo { width:120px; height:60px; display:flex; align-items:center; }
    .header-Logo>img { width:100%; height:auto; object-fit:contain; filter:brightness(1.05) saturate(1.05); }
    .header-nav { display:flex; align-items:center; gap:18px; }
    .header-navlist { display:flex; gap:18px; align-items:center; margin:0; padding:0; list-style:none; }
    .header-navitem a {
      color: #fff;
      text-decoration:none;
      font-weight:700;
      letter-spacing:0.6px;
      padding:10px 14px;
      border-radius:8px;
      transition: background .18s, transform .12s;
      display:inline-block;
    }
    .header-navitem a:hover, .header-navitem a:focus {
      background: rgba(255,255,255,0.06);
      transform: translateY(-2px);
      outline: none;
    }
    .header .cta {
      background: #ffd166;
      color:#1b1b1b;
      padding:10px 14px;
      border-radius:8px;
      font-weight:700;
      text-decoration:none;
      margin-left:14px;
    }

    /* === Page layout === */
    .hero {
      max-width:1200px;
      margin:36px auto 12px;
      padding:18px;
      display:flex;
      gap:20px;
      align-items:center;
    }
    .hero-left {
      flex:1;
      min-width:260px;
    }
    .hero-title {
      font-size:44px;
      margin:0 0 12px;
      color:#2b2b2b;
      letter-spacing:0.2px;
    }
    .hero-sub { color:#6b6b6b; margin:0 0 18px; font-size:16px; line-height:1.6; }
    .hero-actions { display:flex; gap:12px; flex-wrap:wrap; }


    /* === Product grid / full details area === */
    .menu-panel { max-width:1200px; margin:24px auto 80px; padding:0 20px; }
    .controls-row { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:18px; flex-wrap:wrap; }
    .filters { display:flex; gap:10px; align-items:center; }
    .filter-btn { background:#fff;border:1px solid rgba(55,64,99,0.06); padding:8px 12px; border-radius:10px; cursor:pointer; }
    .search { display:flex; gap:8px; align-items:center; background:#fff; padding:8px 10px; border-radius:10px; box-shadow:0 8px 30px rgba(20,20,30,0.03); }
    .search input { border:0; outline:0; min-width:240px; font-size:15px; }

    .products-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:18px; }
    .product {
      background:#fff; border-radius:12px; overflow:hidden; display:flex; flex-direction:column; box-shadow: 0 12px 30px rgba(20,20,30,0.04);
      transition:transform .18s ease, box-shadow .18s ease;
    }
    .product:hover { transform:translateY(-6px); box-shadow: 0 26px 60px rgba(20,20,30,0.08); }
    .product-media { height:160px; overflow:hidden; background:#f5f5f5; }
    .product-media img{ width:100%; height:100%; object-fit:cover; display:block; }
    .product-body { padding:14px; display:flex; flex-direction:column; gap:8px; }
    .product-title { font-weight:700; }
    .product-desc { color:#666; font-size:14px; line-height:1.5; }
    .product-meta { display:flex; justify-content:space-between; align-items:center; margin-top:auto; gap:8px; }

    /* === Drawer detail (used by quick-view) === */
    .drawer {
      position:fixed; right:-100%; top:0; height:100%; width:420px; max-width:96%; background:#fff; box-shadow:-24px 0 60px rgba(0,0,0,.28);
      transition:right .32s cubic-bezier(.22,.9,.3,1); z-index:80; display:flex; flex-direction:column;
    }
    .drawer.open { right:0; }
    .drawer-head { padding:18px; border-bottom:1px solid #f2f2f2; display:flex; justify-content:space-between; align-items:center; }
    .drawer-body { padding:18px; overflow:auto; flex:1; display:flex; flex-direction:column; gap:12px; }

    /* === Floating cart widget === */
    #cartWidget {
      position:fixed;
      right:20px;
      bottom:20px;
      width:360px;
      max-width:calc(100% - 40px);
      z-index:120;
      font-size:14px;
    }
    .cart-panel { background:#fff; border-radius:12px; box-shadow: 0 30px 60px rgba(0,0,0,.18); overflow:hidden; border:1px solid rgba(0,0,0,0.06); }
    .cart-header { padding:12px 14px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #f4f4f4; }
    .cart-body { max-height:320px; overflow:auto; padding:12px; }
    .cart-item { display:flex; gap:10px; align-items:center; padding:10px 0; border-bottom:1px dashed #f4f4f4; }
    .cart-item img { width:64px; height:64px; object-fit:cover; border-radius:8px; }
    .cart-footer { padding:12px; border-top:1px solid #f4f4f4; display:flex; justify-content:space-between; align-items:center; gap:12px; }

    /* === Responsive tweaks === */
    @media (max-width:900px) {
      .hero { flex-direction:column; gap:12px; padding:12px; }
      .subway-viewport { padding:12px; gap:18px; }
      .subway-card { height:320px; --card-width:260px; }
      #cartWidget{right:12px; left:auto; bottom:12px; width:320px; }
      .drawer { width:100%; }
    }
  </style>




</head>
<body>
  <!-- header (keeps original classes exactly) -->
  <header class="header">
    <div class="header-Logo">
      <a href="index.html"><img src="./src/assets/images/Logo.png" alt="Cafe de Coral Logo"></a>
    </div>

    <nav class="header-nav" aria-label="Main navigation">
      <ul class="header-navlist">
        <li class="header-navitem"><a href="index.html">TOP</a></li>
        <li class="header-navitem"><a href="index.html#about">ABOUT</a></li>
        <li class="header-navitem"><a href="menu.html" aria-current="page">MENU</a></li>
        <li class="header-navitem"><a href="index.html#pickup">PICK UP</a></li>
        <li class="header-navitem"><a href="index.html#news">NEWS</a></li>
        <li class="header-navitem"><a href="index.html#access">ACCESS</a></li>
      </ul>
    </nav>

    <div>
      <a class="cta" href="menu.html#menuGrid">Order Online</a>
    </div>
  </header>

  <!-- hero -->
  <section class="hero" aria-hidden="false">
    <div class="hero-left">
      <h1 class="hero-title">Taste the Pause — curated food & drinks</h1>
      <p class="hero-sub">Handmade pastries, single-origin espresso and seasonal plates. Browse, preview and add to cart with a refined, immersive experience.</p>
      <div class="hero-actions">
        <a class="cta" href="#subway">Explore Highlights</a>
        <a class="filter-btn" href="#menuGrid">See full menu</a>
      </div>
    </div>

    <div style="width:460px;min-width:220px;">
      <img src="./src/assets/images/AboutImg.png" alt="coffee art" style="border-radius:14px;box-shadow:0 18px 40px rgba(20,20,30,0.06);">
    </div>
  </section>

  <!-- subway preview carousel -->
  <!-- make the subway carousel be beautiful and show its css codes -->
  <section class="subway" aria-label="Featured items">
    <div class="subway-viewport" id="subwayViewport" tabindex="0" role="list"></div>
    <div class="subway-controls" style="margin-bottom:12px">
      <button class="subway-btn" id="prevBtn" aria-label="Previous">◀</button>
      <button class="subway-btn" id="nextBtn" aria-label="Next">▶</button>
      <button class="subway-btn" id="railPlay" title="Auto-scroll">▶▶</button>
      <button class="subway-btn" id="railPause" title="Stop" style="display:none">⏸</button>
    </div>

    <!-- the orginal style of css files -->
    <!-- <style>
          /* === Preview "subway" carousel (horizontal, center-focused) === */
    .subway {
      --card-width:320px;
      width:100%;
      overflow:hidden;
      padding:36px 0;
      background: linear-gradient(180deg,#fff, #fbfbfb);
    }
    .subway-viewport {
      display:flex;
      gap:28px;
      align-items:center;
      padding:12px 48px;
      will-change:transform;
      transition: transform 320ms cubic-bezier(.22,.9,.3,1);
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling:touch;
    }
    .subway-viewport::-webkit-scrollbar { height:8px; }
    .subway-viewport::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius:999px; }
    .subway-card {
      flex:0 0 var(--card-width);
      height:420px;
      border-radius:18px;
      position:relative;
      scroll-snap-align:center;
      display:flex;
      flex-direction:column;
      justify-content:flex-end;
      padding:18px;
      box-shadow: 0 18px 40px rgba(15,15,30,0.08);
      background:linear-gradient(180deg, rgba(255,255,255,0.82), rgba(250,250,250,0.95));
      transition: transform 240ms ease, box-shadow 240ms ease;
      transform-origin:center center;
      overflow:hidden;
    }
    .subway-card .media {
      position:absolute;
      inset:0;
      display:block;
      transform-origin:center center;
      z-index:0;
      opacity:0.98;
    }
    .subway-card .media img { width:120%; height:120%; object-fit:cover; transform:translate(-8%, -6%); filter:contrast(1.05) saturate(1.03) brightness(0.96); }
    .subway-card .overlay {
      position:relative;
      z-index:2;
      backdrop-filter: blur(4px);
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .subway-card .title { color:#fff; font-size:20px; font-weight:700; text-shadow: 0 6px 18px rgba(0,0,0,0.45); }
    .subway-card .meta { color:#fff; font-size:13px; opacity:0.95; }
    .subway-card .price-badge {
      background: linear-gradient(90deg, rgba(255,255,255,0.16), rgba(255,255,255,0.08));
      color:#fff;
      padding:8px 12px;
      border-radius:999px;
      font-weight:700;
      display:inline-block;
      box-shadow: 0 6px 18px rgba(0,0,0,0.22);
    }

    /* Center emphasis via JS: large center card, decreasing size outwards */
    .subway-card.center {
      transform: scale(1.14);
      box-shadow: 0 30px 70px rgba(10,10,30,0.20);
      z-index:6;
    }
    .subway-card.near { transform: scale(1.06); z-index:5; }
    .subway-card.far { transform: scale(.93); z-index:4; opacity:0.95; }
    .subway-card.distant { transform: scale(.84); z-index:3; opacity:0.75; }

    .subway-controls { display:flex; gap:10px; justify-content:center; margin-top:18px; }
    .subway-btn { background:#fff;border-radius:999px;border:0;padding:10px 14px;box-shadow:0 8px 20px rgba(10,10,30,0.06); cursor:pointer; }

    </style> -->
    <!-- the new upgrade css -->
    <style>
      /* ---------- Container ---------- */
      .subway{
        --card-width:360px;
        --gap:28px;
        --ease:cubic-bezier(.22,.9,.3,1);
        max-width:1200px;
        margin:18px auto;
        padding:28px 0 34px;
        background:linear-gradient(180deg,#fff,#fcfbfa);
        position:relative;
        border-radius:14px;
      }
      
      /* ---------- Viewport ---------- */
      .subway-viewport{
        display:flex;
        gap:var(--gap);
        padding:14px 40px;
        overflow-x:auto;
        scroll-snap-type:x mandatory;
        -webkit-overflow-scrolling:touch;
        align-items:center;
        will-change:transform;
        perspective:1400px;
        transform-style:preserve-3d;
        transition:transform 320ms var(--ease);
      }
      .subway-viewport::-webkit-scrollbar{height:10px}
      .subway-viewport::-webkit-scrollbar-thumb{background:rgba(0,0,0,.09);border-radius:999px}
      
      /* ---------- Card ---------- */
      .subway-card{
        --w:var(--card-width);
        flex:0 0 var(--w);
        height:460px;
        border-radius:18px;
        position:relative;
        overflow:hidden;
        scroll-snap-align:center;
        display:flex;
        flex-direction:column;
        justify-content:flex-end;
        padding:20px;
        cursor:pointer;
        transform-origin:center center;
        transition:
          transform .36s var(--ease),
          box-shadow .36s var(--ease),
          filter .36s var(--ease),
          opacity .36s var(--ease);
        background:linear-gradient(180deg,rgba(0,0,0,0.14),rgba(0,0,0,0.08));
        color:#fff;
        box-shadow:0 14px 36px rgba(8,8,20,0.08);
        border:1px solid rgba(255,255,255,0.03);
        opacity:0;
        transform:translateY(18px) scale(.98);
      }
      
      /* visible entrance */
      .subway-card.visible{opacity:1;transform:translateY(0) scale(1)}
      
      /* media layer */
      .subway-card .media{position:absolute;inset:0;z-index:0;overflow:hidden}
      .subway-card .media img{
        width:120%;
        height:120%;
        object-fit:cover;
        transform:translate(-6%,-6%) scale(1);
        filter:contrast(1.06) saturate(1.06) brightness(.92);
        transition:transform .8s var(--ease),filter .36s var(--ease);
      }
      
      /* subtle top gradient for depth */
      .subway-card .layer{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.04),rgba(0,0,0,0.46));z-index:1}
      
      /* content overlay */
      .subway-card .content{position:relative;z-index:2;backdrop-filter: blur(2px);padding-bottom:6px}
      .subway-card .title{font-size:20px;font-weight:800;text-shadow:0 10px 28px rgba(0,0,0,0.45)}
      .subway-card .meta{font-size:13px;color:rgba(255,255,255,0.95);margin-top:6px;opacity:.95}
      .subway-card .price{margin-top:12px;display:inline-block;background:linear-gradient(90deg,#ffd166,#ff8a66);padding:9px 16px;border-radius:999px;font-weight:900;color:#222;box-shadow:0 14px 36px rgba(0,0,0,0.22)}
      
      /* ---------- Depth classes (JS assigns these) ---------- */
      .subway-card.center{
        transform:translateZ(0) scale(1.22) translateY(-18px) rotateY(0deg);
        box-shadow:0 40px 90px rgba(8,10,30,0.28);
        z-index:6;
      }
      .subway-card.near{
        transform:translateZ(-10px) scale(1.06) translateY(-8px) rotateY(-6deg);
        z-index:5;
      }
      .subway-card.far{
        transform:translateZ(-26px) scale(.94) translateY(0) rotateY(-10deg);
        z-index:4;opacity:.96;filter:grayscale(.04);
      }
      .subway-card.distant{
        transform:translateZ(-60px) scale(.82) translateY(10px) rotateY(-14deg);
        z-index:3;opacity:.78;filter:grayscale(.14);
      }
      
      /* hover emphasis */
      .subway-card:hover{transform:translateZ(10px) scale(1.12) translateY(-12px);box-shadow:0 40px 100px rgba(8,10,30,0.32)}
      .subway-card.center:hover{transform:translateZ(22px) scale(1.26) translateY(-24px)}
      .subway-card.center:hover .media img{transform:scale(1.06) translate(-4%,-4%)}
      
      /* small interaction polish */
      .subway-card:active{transform:translateY(-6px) scale(.996)}
      .subway-card .overlay{position:relative;z-index:2;display:flex;flex-direction:column;gap:6px}
      
      /* ---------- Controls ---------- */
      .subway-controls{display:flex;justify-content:center;gap:12px;margin-top:18px}
      .subway-btn{background:#fff;border:0;border-radius:999px;padding:10px 14px;box-shadow:0 12px 30px rgba(12,12,30,0.06);cursor:pointer;transition:transform .14s ease}
      .subway-btn:hover{transform:translateY(-3px)}
      
      /* responsive */
      @media (max-width:980px){
        .subway{padding:18px 0}
        .subway-viewport{padding:10px 20px}
        .subway-card{--w:300px;height:420px;border-radius:14px;padding:16px}
      }
      @media (max-width:620px){
        .subway-card{--w:260px;height:380px;padding:12px}
        .subway{padding:12px 0}
      }
    </style>

  </section>












<!-- testing of image  -->































  <!-- full menu area -->
  <section class="menu-panel">
    <div class="controls-row">
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
        <div class="filters" role="tablist" aria-label="Category filters">
          <button class="filter-btn" data-filter="all">All</button>
          <button class="filter-btn" data-filter="food">Food</button>
          <button class="filter-btn" data-filter="drink">Drink</button>
        </div>
        <div class="search" role="search" style="margin-left:8px;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#6b6b6b" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="#6b6b6b" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></circle></svg>
          <input id="searchInput" placeholder="Search dishes, ingredients or tags" aria-label="Search menu">
        </div>
      </div>

      <div>
        <select id="sortSelect" class="filter-btn" aria-label="Sort menu">
          <option value="featured">Featured</option>
          <option value="price-asc">Price low → high</option>
          <option value="price-desc">Price high → low</option>
          <option value="alpha">A → Z</option>
        </select>
      </div>
    </div>

    <div class="products-grid" id="menuGrid" aria-live="polite">
      <!-- product cards injected by JS -->
    </div>
  </section>

  <!-- drawer quick-view -->
  <aside id="drawer" class="drawer" aria-hidden="true" role="dialog" aria-labelledby="drawerTitle">
    <div class="drawer-head">
      <div>
        <strong id="drawerTitle">Item</strong>
        <div class="muted" id="drawerCategory">CATEGORY</div>
      </div>
      <div>
        <button id="drawerClose" class="filter-btn">Close</button>
      </div>
    </div>

    <div class="drawer-body">
      <div class="drawer-media" id="drawerMedia"><img src="./src/assets/images/PickUp01.png" alt=""></div>
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div id="drawerPrice" style="font-weight:700;font-size:20px;color:#2b2b2b">€0.00</div>
        <div><button id="drawerAdd" class="cta">Add to cart</button></div>
      </div>
      <div id="drawerDesc" class="muted">Description</div>
      <div>
        <div style="font-weight:700;margin-bottom:8px">Sizes</div>
        <div class="drawer-variations" id="drawerSizes"></div>
      </div>
      <div>
        <div style="font-weight:700;margin-top:8px">Ingredients & Allergens</div>
        <dl style="margin:0;color:#6b6b6b">
          <dt style="font-weight:700">Ingredients</dt><dd id="drawerIngredients">—</dd>
          <dt style="font-weight:700;margin-top:8px">Allergens</dt><dd id="drawerAllergens">—</dd>
          <dt style="font-weight:700;margin-top:8px">Calories</dt><dd id="drawerCalories">—</dd>
        </dl>
      </div>
    </div>
  </aside>

  <!-- persistent cart widget -->
  <div id="cartWidget" aria-live="polite"></div>

  <!-- footer (keeps original classes) -->
  <footer class="footer" style="margin-top:30px;background:#374063;">
    <div class="footer-nav">
      <ul class="footer-navlist" style="display:flex;gap:18px;padding:18px;align-items:center;justify-content:center;margin:0">
        <li class="footer-navitem"><a href="index.html#about" style="color:#fff;text-decoration:none">ABOUT</a></li>
        <li class="footer-navitem"><a href="menu.html" style="color:#fff;text-decoration:none">MENU</a></li>
        <li class="footer-navitem"><a href="index.html#pickup" style="color:#fff;text-decoration:none">PICK UP</a></li>
        <li class="footer-navitem"><a href="index.html#news" style="color:#fff;text-decoration:none">NEWS</a></li>
        <li class="footer-navitem"><a href="index.html#access" style="color:#fff;text-decoration:none">ACCESS</a></li>
      </ul>
    </div>
    <div class="footer-logo" style="padding:18px;text-align:center">
      <div class="footer-logo-img"><img src="./src/assets/images/Logo.png" alt="" style="width:120px;height:auto"></div>
    </div>
    <div style="text-align:center;padding:12px;color:#fff">Cafe de Coral ©2025</div>
  </footer>






  <script>
    /* ===========================
       Data: sample products
       =========================== */
    const PRODUCTS = [
      { id:101, category:'food', title:'Avocado Toast', price:7.20, img:'./src/assets/images/PickUp01.png', hero: './src/assets/images/TopImg01.png', desc:'Smashed avocado, lemon, chilli and olive oil on toasted sourdough.', tags:['vegan','bestseller'], ingredients:'Avocado, bread, lemon, olive oil', allergens:'Gluten', cal:'420 kcal', sizes:[{label:'Regular',price:7.2},{label:'Double',price:9.5}] },
      { id:102, category:'food', title:'Seasonal Scone', price:4.50, img:'./src/assets/images/PickUp01.png', hero:'./src/assets/images/TopImg02.png', desc:'Buttery scone served with house jam.', tags:['bakery'], ingredients:'Flour, butter, sugar, eggs', allergens:'Dairy, Gluten, Eggs', cal:'350 kcal', sizes:[{label:'Single',price:4.5},{label:'Box 3',price:12.0}] },
      { id:103, category:'food', title:'Quiche Lorraine', price:6.90, img:'./src/assets/images/PickUp01.png', hero:'./src/assets/images/TopImg03.png', desc:'Classic quiche with smoky bacon and gruyere.', tags:['classic'], ingredients:'Egg, cream, bacon, cheese', allergens:'Eggs, Dairy, Gluten', cal:'520 kcal', sizes:[{label:'Slice',price:6.9}] },
      { id:201, category:'drink', title:'Espresso', price:2.80, img:'./src/assets/images/PickUp01.png', hero:'./src/assets/images/TopImg01.png', desc:'Rich single-origin espresso.', tags:['hot','espresso'], ingredients:'Coffee', allergens:'—', cal:'5 kcal', sizes:[{label:'Single',price:2.8},{label:'Double',price:3.6}] },
      { id:202, category:'drink', title:'Cappuccino', price:3.80, img:'./src/assets/images/PickUp01.png', hero:'./src/assets/images/TopImg02.png', desc:'Steamed milk and velvety foam over espresso.', tags:['hot','milk'], ingredients:'Espresso, milk', allergens:'Dairy', cal:'150 kcal', sizes:[{label:'Regular',price:3.8},{label:'Large',price:4.5}] },
      { id:203, category:'drink', title:'Iced Latte', price:4.20, img:'./src/assets/images/PickUp01.png', hero:'./src/assets/images/TopImg03.png', desc:'Chilled milk and espresso over ice.', tags:['cold'], ingredients:'Espresso, milk, ice', allergens:'Dairy', cal:'160 kcal', sizes:[{label:'Regular',price:4.2}] }
    ];

    /* ===========================
       Subway carousel rendering
       =========================== */
    const viewport = document.getElementById('subwayViewport');

    function createCard(p){
      const a = document.createElement('a');
      a.className = 'subway-card';
      a.href = `product-${p.id}.html`;
      a.innerHTML = `
        <div class="media"><img src="${p.hero||p.img}" alt="${p.title}"></div>
        <div class="overlay">
          <div class="title">${p.title}</div>
          <div class="meta">${p.tags.join(' • ')} • ${p.cal}</div>
          <div style="margin-top:10px"><span class="price-badge">€${p.price.toFixed(2)}</span></div>
        </div>
      `;
      a.dataset.id = p.id;
      return a;
    }

    function populateSubway(){
      viewport.innerHTML = '';
      PRODUCTS.forEach(p => viewport.appendChild(createCard(p)));
      updateCenterClasses();
    }
    populateSubway();

    /* center detection & class assignment for "train" effect */
    function updateCenterClasses(){
      const cards = Array.from(viewport.children);
      if(!cards.length) return;
      const vpRect = viewport.getBoundingClientRect();
      const vpCenter = vpRect.left + vpRect.width / 2;
      cards.forEach(card => {
        const r = card.getBoundingClientRect();
        const cardCenter = r.left + r.width / 2;
        const dist = Math.abs(cardCenter - vpCenter);
        const max = Math.max(vpRect.width, 600);
        card.classList.remove('center','near','far','distant');
        if(dist < r.width * 0.6) card.classList.add('center');
        else if(dist < r.width * 1.6) card.classList.add('near');
        else if(dist < r.width * 3) card.classList.add('far');
        else card.classList.add('distant');
      });
    }

    /* enable smooth rail-style scrolling via buttons */
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    function scrollByCard(direction = 1){
      const cards = Array.from(viewport.children);
      if(!cards.length) return;
      const vpRect = viewport.getBoundingClientRect();
      const vpCenter = vpRect.left + vpRect.width / 2;
      // find current center card index
      let centerIndex = 0;
      let minDist = Infinity;
      cards.forEach((c,i)=>{
        const r = c.getBoundingClientRect();
        const cardCenter = r.left + r.width / 2;
        const dist = Math.abs(cardCenter - vpCenter);
        if(dist < minDist){ minDist = dist; centerIndex = i; }
      });
      const targetIndex = Math.min(Math.max(centerIndex + direction, 0), cards.length - 1);
      const target = cards[targetIndex];
      const targetRect = target.getBoundingClientRect();
      const currentScroll = viewport.scrollLeft;
      // compute new scroll to center the target
      const offset = (targetRect.left + targetRect.width/2) - vpCenter;
      // smooth scroll
      viewport.scrollTo({ left: currentScroll + offset, behavior: 'smooth' });
    }

    prevBtn.addEventListener('click', ()=> scrollByCard(-1));
    nextBtn.addEventListener('click', ()=> scrollByCard(1));

    /* update classes on scroll / resize */
    let scrollTimeout;
    viewport.addEventListener('scroll', ()=> {
      window.clearTimeout(scrollTimeout);
      updateCenterClasses();
      // reduce update frequency
      scrollTimeout = window.setTimeout(updateCenterClasses, 80);
    });
    window.addEventListener('resize', updateCenterClasses);

    /* enable arrow-key control */
    viewport.addEventListener('keydown', (e)=> {
      if(e.key === 'ArrowRight') scrollByCard(1);
      if(e.key === 'ArrowLeft') scrollByCard(-1);
    });

    /* clicking a non-link quick-view (if needed) - but cards link to product pages for SEO */
    viewport.addEventListener('click', (e)=> {
      const card = e.target.closest('.subway-card');
      if(!card) return;
      // normal anchor will navigate; if user used modifier (ctrl/meta) allow open in new tab
    });

    /* ===========================
       Menu grid rendering
       =========================== */
    const menuGrid = document.getElementById('menuGrid');
    function formatP(n){ return '€' + n.toFixed(2); }

    function productCardMarkup(p){
      return `
        <article class="product" data-id="${p.id}">
          <a href="product-${p.id}.html" style="text-decoration:none;color:inherit;">
            <div class="product-media"><img src="${p.img}" alt="${p.title}"></div>
          </a>
          <div class="product-body">
            <div style="display:flex;justify-content:space-between;align-items:start;gap:10px;">
              <a href="product-${p.id}.html" style="text-decoration:none;color:inherit;">
                <div class="product-title">${p.title}</div>
              </a>
              <div class="price">${formatP(p.price)}</div>
            </div>
            <div class="product-desc">${p.desc}</div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;">
              <div class="muted">${p.tags.join(' • ')}</div>
              <div style="display:flex;gap:8px;">
                <button class="filter-btn quick-view" data-id="${p.id}" type="button">Quick View</button>
                <button class="cta add-mini" data-id="${p.id}" type="button">Add</button>
              </div>
            </div>
          </div>
        </article>
      `;
    }

    function renderGrid(list = PRODUCTS){
      menuGrid.innerHTML = list.map(productCardMarkup).join('');
    }
    renderGrid();

    /* Filters and search */
    const filterBtns = document.querySelectorAll('.filter-btn[data-filter]');
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');

    function applyFilters(){
      const q = (searchInput.value || '').trim().toLowerCase();
      const active = Array.from(filterBtns).find(b => b.classList.contains('active'))?.dataset.filter || 'all';
      let out = PRODUCTS.filter(p => {
        const byCat = active === 'all' ? true : p.category === active;
        const byQ = !q ? true : (p.title + ' ' + p.desc + ' ' + p.tags.join(' ') + ' ' + p.ingredients).toLowerCase().includes(q);
        return byCat && byQ;
      });
      const s = sortSelect.value;
      if(s === 'price-asc') out.sort((a,b)=>a.price-b.price);
      else if(s === 'price-desc') out.sort((a,b)=>b.price-a.price);
      else if(s === 'alpha') out.sort((a,b)=>a.title.localeCompare(b.title));
      renderGrid(out);
      // also re-populate subway with featured (top 6) for visual coherence
      populateSubway(); // keep same set for now
    }

    // init filter button active state
    document.querySelectorAll('.filters .filter-btn').forEach(b => {
      b.addEventListener('click', () => {
        document.querySelectorAll('.filters .filter-btn').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        applyFilters();
      });
    });
    // set default active = all
    document.querySelector('.filters .filter-btn[data-filter="all"]').classList.add('active');

    searchInput.addEventListener('input', applyFilters);
    sortSelect.addEventListener('change', applyFilters);

    /* ===========================
       Drawer quick-view interaction
       =========================== */
    const drawer = document.getElementById('drawer');
    const drawerTitle = document.getElementById('drawerTitle');
    const drawerCategory = document.getElementById('drawerCategory');
    const drawerMedia = document.getElementById('drawerMedia');
    const drawerPrice = document.getElementById('drawerPrice');
    const drawerDesc = document.getElementById('drawerDesc');
    const drawerSizes = document.getElementById('drawerSizes');
    const drawerIngredients = document.getElementById('drawerIngredients');
    const drawerAllergens = document.getElementById('drawerAllergens');
    const drawerCalories = document.getElementById('drawerCalories');
    const drawerAdd = document.getElementById('drawerAdd');

    document.addEventListener('click', (e) => {
      const t = e.target;
      if(t.matches('.quick-view')) {
        const id = t.dataset.id;
        openDrawer(id);
        return;
      }
      if(t.id === 'drawerClose') { closeDrawer(); return; }
      if(t.id === 'drawerAdd') {
        const id = drawerAdd.dataset.id;
        const price = parseFloat(drawerAdd.dataset.price || drawerPrice.textContent.replace(/[^\d.]/g,''));
        addToCart({ id: String(id), title: drawerTitle.textContent, price: price, qty:1, img: drawerMedia.querySelector('img')?.src || '' });
      }
      if(t.matches('.size-pill')) {
        drawerSizes.querySelectorAll('.size-pill').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        const p = parseFloat(t.dataset-price);
        drawerPrice.textContent = formatP(p);
        drawerAdd.dataset.price = p;
      }
    });

    function openDrawer(id){
      const p = PRODUCTS.find(x => String(x.id) === String(id));
      if(!p) return;
      drawerTitle.textContent = p.title;
      drawerCategory.textContent = p.category.toUpperCase();
      drawerMedia.innerHTML = `<img src="${p.img}" alt="${p.title}">`;
      drawerPrice.textContent = formatP(p.price);
      drawerDesc.textContent = p.desc;
      drawerIngredients.textContent = p.ingredients || '—';
      drawerAllergens.textContent = p.allergens || '—';
      drawerCalories.textContent = p.cal || '—';
      drawerSizes.innerHTML = (p.sizes || []).map((s,i)=>`<button class="size-pill" data-price="${s.price}" data-idx="${i}">${s.label} — ${formatP(s.price)}</button>`).join('');
      // default first size active
      const first = drawerSizes.querySelector('.size-pill');
      if(first) first.classList.add('active');
      drawer.classList.add('open');
      drawer.setAttribute('aria-hidden','false');
      drawerAdd.dataset.id = p.id;
      drawerAdd.dataset.price = p.sizes?.[0]?.price || p.price;
    }
    function closeDrawer(){ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); }

    // allow Esc to close drawer
    document.addEventListener('keydown', (e)=> { if(e.key === 'Escape') closeDrawer(); });

    /* ===========================
       Lightweight cart persisted in localStorage
       =========================== */
    (function initCartWidget(){
      const KEY = 'CART@CAFED';
      const container = document.getElementById('cartWidget');

      container.innerHTML = `
        <div class="cart-panel" role="region" aria-label="Shopping cart">
          <div class="cart-header"><strong>Cart</strong><div><button id="clearCart" class="filter-btn">Clear</button></div></div>
          <div class="cart-body" id="cartBody"></div>
          <div class="cart-footer"><div><div class="muted">Total</div><div id="cartTotal" style="font-weight:700">€0.00</div></div><div><button id="checkoutBtn" class="cta">Checkout</button></div></div>
        </div>
      `;

      function getCart(){ return JSON.parse(localStorage.getItem(KEY) || '[]'); }
      function saveCart(c){ localStorage.setItem(KEY, JSON.stringify(c)); render(); window.dispatchEvent(new Event('cart:update')); }
      function formatP(n){ return '€' + n.toFixed(2); }

      function render(){
        const body = document.getElementById('cartBody');
        const cart = getCart();
        if(!cart.length){ body.innerHTML = '<div class="cart-empty muted">Your cart is empty</div>'; document.getElementById('cartTotal').textContent = formatP(0); return; }
        body.innerHTML = '';
        let total = 0;
        cart.forEach((it, idx) => {
          total += it.price * (it.qty || 1);
          const div = document.createElement('div');
          div.className = 'cart-item';
          div.innerHTML = `
            <img src="${it.img}" alt="${it.title}">
            <div style="flex:1">
              <div style="font-weight:700">${it.title}</div>
              <div class="muted">€${it.price.toFixed(2)} × <span class="qty">${it.qty}</span></div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="filter-btn qty-minus" data-idx="${idx}">−</button>
              <button class="filter-btn qty-plus" data-idx="${idx}">+</button>
              <button class="filter-btn remove" data-idx="${idx}">✕</button>
            </div>
          `;
          body.appendChild(div);
        });
        document.getElementById('cartTotal').textContent = formatP(total);
      }

      container.addEventListener('click', (e) => {
        const t = e.target;
        if(t.id === 'clearCart'){ localStorage.removeItem(KEY); render(); return; }
        if(t.id === 'checkoutBtn'){ alert('Proceed to checkout — integrate payment flow'); return; }
        if(t.matches('.qty-plus')) {
          const idx = +t.dataset.idx; const c = getCart(); c[idx].qty = (c[idx].qty || 1) + 1; saveCart(c); return;
        }
        if(t.matches('.qty-minus')) {
          const idx = +t.dataset.idx; const c = getCart(); c[idx].qty = Math.max(1, (c[idx].qty || 1) - 1); saveCart(c); return;
        }
        if(t.matches('.remove')) {
          const idx = +t.dataset.idx; const c = getCart(); c.splice(idx,1); saveCart(c); return;
        }
      });

      window.CafeCart = {
        add(item) {
          const c = getCart();
          const existing = c.find(i => i.id === item.id && i.price === item.price);
          if(existing) existing.qty = (existing.qty||1) + (item.qty||1);
          else c.push(Object.assign({qty: item.qty||1}, item));
          saveCart(c);
        },
        get() { return getCart(); },
        clear() { localStorage.removeItem(KEY); render(); }
      };

      window.addEventListener('cart:update', render);
      window.addEventListener('storage', render);
      render();
    })();

    /* helper exposed for quick add from grid */
    function addToCart(item){ window.CafeCart.add(item); }

    document.addEventListener('click', (e) => {
      const t = e.target;
      if(t.matches('.add-mini')) {
        const id = t.dataset.id;
        const p = PRODUCTS.find(x => String(x.id) === String(id));
        if(!p) return;
        addToCart({ id:String(p.id), title:p.title, price:p.price, qty:1, img:p.img });
        t.textContent = '✓ Added';
        t.disabled = true;
        setTimeout(()=>{ t.textContent = 'Add'; t.disabled = false; }, 1000);
      }
      if(t.closest('.product') && t.matches('.product')) {
        // link handled by anchor; not used here
      }
    });

    /* initial enhancement: ensure the subway center classes on first paint and after images load */
    window.addEventListener('load', () => {
      setTimeout(updateCenterClasses, 120);
      // observe for resize of items (images)
      const ro = new ResizeObserver(() => updateCenterClasses());
      ro.observe(viewport);
    });

    /* keyboard accessibility: left/right on document to navigate subway */
    document.addEventListener('keydown', (e) => {
      if(document.activeElement && (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA')) return;
      if(e.key === 'ArrowRight') scrollByCard(1);
      if(e.key === 'ArrowLeft') scrollByCard(-1);
    });
  </script>
</body>
</html>