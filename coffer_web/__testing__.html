<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Subway Carousel ‚Äî Demo (HTML + CSS + JS)</title>
  <style>
    /* ---------- Container ---------- */
    :root{--card-width:360px;--gap:28px;--ease:cubic-bezier(.22,.9,.3,1)}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f3f4f6; margin:18px}
    .container{max-width:1200px;margin:0 auto;padding:18px}

    .subway{
      max-width:1200px;
      margin:18px auto;
      padding:28px 0 34px;
      background:linear-gradient(180deg,#fff,#fcfbfa);
      position:relative;
      border-radius:14px;
      box-shadow:0 8px 30px rgba(8,10,30,0.06);
    }

    /* ---------- Viewport ---------- */
    .subway-viewport{
      display:flex;
      gap:var(--gap);
      padding:14px 40px;
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling:touch;
      align-items:center;
      will-change:transform;
      perspective:1400px;
      transform-style:preserve-3d;
      transition:transform 320ms var(--ease);
      outline: none;
    }
    .subway-viewport::-webkit-scrollbar{height:10px}
    .subway-viewport::-webkit-scrollbar-thumb{background:rgba(0,0,0,.09);border-radius:999px}

    /* ---------- Card ---------- */
    .subway-card{
      --w:var(--card-width);
      flex:0 0 var(--w);
      height:460px;
      border-radius:18px;
      position:relative;
      overflow:hidden;
      scroll-snap-align:center;
      display:flex;
      flex-direction:column;
      justify-content:flex-end;
      padding:20px;
      cursor:pointer;
      transform-origin:center center;
      transition:
        transform .36s var(--ease),
        box-shadow .36s var(--ease),
        filter .36s var(--ease),
        opacity .36s var(--ease);
      background:linear-gradient(180deg,rgba(0,0,0,0.14),rgba(0,0,0,0.08));
      color:#fff;
      box-shadow:0 14px 36px rgba(8,8,20,0.08);
      border:1px solid rgba(255,255,255,0.03);
      opacity:0;
      transform:translateY(18px) scale(.98);
      user-select:none;
    }

    /* visible entrance */
    .subway-card.visible{opacity:1;transform:translateY(0) scale(1)}

    /* media layer */
    .subway-card .media{position:absolute;inset:0;z-index:0;overflow:hidden;background:#000}
    .subway-card .media img{
      width:120%;
      height:120%;
      object-fit:cover;
      transform:translate(-6%,-6%) scale(1);
      filter:contrast(1.06) saturate(1.06) brightness(.92);
      transition:transform .8s var(--ease),filter .36s var(--ease);
      will-change:transform,filter;
    }

    /* subtle top gradient for depth */
    .subway-card .layer{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.04),rgba(0,0,0,0.46));z-index:1}

    /* content overlay */
    .subway-card .content{position:relative;z-index:2;backdrop-filter: blur(2px);padding-bottom:6px}
    .subway-card .title{font-size:20px;font-weight:800;text-shadow:0 10px 28px rgba(0,0,0,0.45)}
    .subway-card .meta{font-size:13px;color:rgba(255,255,255,0.95);margin-top:6px;opacity:.95}
    .subway-card .price{margin-top:12px;display:inline-block;background:linear-gradient(90deg,#ffd166,#ff8a66);padding:9px 16px;border-radius:999px;font-weight:900;color:#222;box-shadow:0 14px 36px rgba(0,0,0,0.22)}

    /* depth classes (JS assigns these) */
    .subway-card.center{
      transform:translateZ(0) scale(1.22) translateY(-18px) rotateY(0deg);
      box-shadow:0 40px 90px rgba(8,10,30,0.28);
      z-index:6;
    }
    .subway-card.near{
      transform:translateZ(-10px) scale(1.06) translateY(-8px) rotateY(-6deg);
      z-index:5;
    }
    .subway-card.far{
      transform:translateZ(-26px) scale(.94) translateY(0) rotateY(-10deg);
      z-index:4;opacity:.96;filter:grayscale(.04);
    }
    .subway-card.distant{
      transform:translateZ(-60px) scale(.82) translateY(10px) rotateY(-14deg);
      z-index:3;opacity:.78;filter:grayscale(.14);
    }

    /* hover emphasis */
    .subway-card:hover{transform:translateZ(10px) scale(1.12) translateY(-12px);box-shadow:0 40px 100px rgba(8,10,30,0.32)}
    .subway-card.center:hover{transform:translateZ(22px) scale(1.26) translateY(-24px)}
    .subway-card.center:hover .media img{transform:scale(1.06) translate(-4%,-4%)}

    /* small interaction polish */
    .subway-card:active{transform:translateY(-6px) scale(.996)}
    .subway-card .overlay{position:relative;z-index:2;display:flex;flex-direction:column;gap:6px}

    /* ---------- Controls ---------- */
    .subway-controls{display:flex;justify-content:center;gap:12px;margin-top:18px}
    .subway-btn{background:#fff;border:0;border-radius:999px;padding:10px 14px;box-shadow:0 12px 30px rgba(12,12,30,0.06);cursor:pointer;transition:transform .14s ease}
    .subway-btn:hover{transform:translateY(-3px)}

    /* ---------- Drawer (quick view) ---------- */
    .drawer{position:fixed;right:18px;top:18px;width:360px;max-width:calc(100% - 36px);background:#fff;border-radius:12px;box-shadow:0 30px 60px rgba(8,10,30,0.2);overflow:hidden;transform:translateY(-8px);transition:transform .28s ease,opacity .28s ease;opacity:0;pointer-events:none}
    .drawer.open{opacity:1;pointer-events:auto;transform:translateY(0)}
    .drawer .drawer-body{padding:14px}
    .drawer .drawer-media img{width:100%;height:160px;object-fit:cover;border-radius:8px}
    .drawer .drawer-title{font-weight:800;margin-top:8px}
    .drawer .drawer-meta{font-size:13px;color:#666;margin-top:6px}
    .drawer .drawer-actions{display:flex;gap:8px;margin-top:12px;align-items:center}

    /* ---------- Cart widget (mini) ---------- */
    .cart-widget{position:fixed;left:18px;bottom:18px;background:#fff;border-radius:12px;padding:10px;box-shadow:0 20px 40px rgba(8,10,30,0.12);display:flex;flex-direction:column;gap:8px;min-width:220px}
    .cart-widget.hidden{display:none}
    .cart-panel .cart-header{display:flex;justify-content:space-between;align-items:center;padding:8px}

    /* responsive */
    @media (max-width:980px){
      :root{--card-width:300px}
      .subway-viewport{padding:10px 20px}
      .subway-card{height:420px;border-radius:14px;padding:16px}
      .drawer{right:12px;left:12px;width:auto}
    }
    @media (max-width:620px){
      :root{--card-width:260px}
      .subway-card{height:380px;padding:12px}
      .drawer{position:fixed;left:12px;right:12px;top:auto;bottom:18px;width:auto}
    }

    /* focus visibility */
    .subway-card:focus{outline:3px solid rgba(255,209,102,0.18);outline-offset:6px}
  </style>
</head>
<body>
  <div class="container">
    <section class="subway" aria-label="Featured items">
      <div class="subway-viewport" id="subwayViewport" tabindex="0" role="list" aria-live="polite"></div>

      <div class="subway-controls" style="margin-bottom:12px">
        <button class="subway-btn" id="prevBtn" aria-label="Previous">‚óÄ</button>
        <button class="subway-btn" id="nextBtn" aria-label="Next">‚ñ∂</button>
        <button class="subway-btn" id="railPlay" title="Auto-scroll">‚ñ∂‚ñ∂</button>
        <button class="subway-btn" id="railPause" title="Stop" style="display:none">‚è∏</button>
      </div>
    </section>
  </div>

  <!-- Drawer quick-view -->
  <div id="drawer" class="drawer" aria-hidden="true" role="dialog" aria-label="Quick view">
    <div class="drawer-body">
      <div id="drawerMedia" class="drawer-media"></div>
      <div id="drawerTitle" class="drawer-title"></div>
      <div id="drawerPrice" class="drawer-meta" style="font-weight:800;margin-top:6px"></div>
      <div id="drawerDesc" class="drawer-meta"></div>
      <div id="drawerSizes" style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap"></div>
      <div class="drawer-actions">
        <button id="drawerAdd" class="subway-btn">Add to cart</button>
        <button id="drawerCancel" class="subway-btn">Cancel</button>
        <button id="drawerClose" class="subway-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Cart widget -->
  <div id="cartWidget" class="cart-widget hidden" aria-hidden="true"></div>
  <button id="cartIcon" style="position:fixed;left:18px;bottom:100px;background:#ffd166;border-radius:999px;padding:12px;border:0;box-shadow:0 12px 30px rgba(12,12,30,.06);cursor:pointer">üõí</button>

  <script>
    /* ===========================
       Single-file JS: carousel + drawer + cart
       =========================== */

    /* Demo product feed (5 products) */
    const PRODUCTS = [
      { id:101, category:'food', title:'Avocado Toast', price:7.20, img:'https://picsum.photos/id/1018/480/320', hero:'https://picsum.photos/id/1018/1200/800', desc:'Smashed avocado, lemon, chilli, olive oil on toasted sourdough.', tags:['vegan','bestseller'], ingredients:'Avocado, sourdough, lemon, olive oil', allergens:'Gluten', cal:'420 kcal', sizes:[{label:'Regular',price:7.2},{label:'Double',price:9.5}]},
      { id:102, category:'food', title:'Seasonal Scone', price:4.50, img:'https://picsum.photos/id/1025/480/320', hero:'https://picsum.photos/id/1025/1200/800', desc:'Buttery scone served with house jam.', tags:['bakery'], ingredients:'Flour, butter, sugar, eggs', allergens:'Dairy, Gluten, Eggs', cal:'350 kcal', sizes:[{label:'Single',price:4.5},{label:'Box 3',price:12.0}]},
      { id:103, category:'food', title:'Quiche Lorraine', price:6.90, img:'https://picsum.photos/id/1003/480/320', hero:'https://picsum.photos/id/1003/1200/800', desc:'Classic quiche with smoky bacon and gruyere.', tags:['classic'], ingredients:'Egg, cream, bacon, cheese', allergens:'Eggs, Dairy, Gluten', cal:'520 kcal', sizes:[{label:'Slice',price:6.9}]},
      { id:201, category:'drink', title:'Espresso', price:2.80, img:'https://picsum.photos/id/1041/480/320', hero:'https://picsum.photos/id/1041/1200/800', desc:'Rich single-origin espresso.', tags:['hot','espresso'], ingredients:'Coffee', allergens:'‚Äî', cal:'5 kcal', sizes:[{label:'Single',price:2.8},{label:'Double',price:3.6}]},
      { id:202, category:'drink', title:'Cappuccino', price:3.80, img:'https://picsum.photos/id/1052/480/320', hero:'https://picsum.photos/id/1052/1200/800', desc:'Steamed milk and velvety foam over espresso.', tags:['hot','milk'], ingredients:'Espresso, milk', allergens:'Dairy', cal:'150 kcal', sizes:[{label:'Regular',price:3.8},{label:'Large',price:4.5}]}
    ];

    /* Helpers */
    const fmt = n => '‚Ç¨' + Number(n).toFixed(2);
    const viewport = document.getElementById('subwayViewport');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const playBtn = document.getElementById('railPlay');
    const pauseBtn = document.getElementById('railPause');
    const drawer = document.getElementById('drawer');
    const drawerTitle = document.getElementById('drawerTitle');
    const drawerMedia = document.getElementById('drawerMedia');
    const drawerPrice = document.getElementById('drawerPrice');
    const drawerDesc = document.getElementById('drawerDesc');
    const drawerSizes = document.getElementById('drawerSizes');
    const drawerAdd = document.getElementById('drawerAdd');
    const drawerCancel = document.getElementById('drawerCancel');
    const drawerClose = document.getElementById('drawerClose');
    const cartWidget = document.getElementById('cartWidget');
    const cartIcon = document.getElementById('cartIcon');

    /* Create card */
    function createCard(p, idx){
      const el = document.createElement('a');
      el.className = 'subway-card';
      el.href = `#product-${p.id}`;
      el.dataset.id = p.id;
      el.dataset.index = idx;
      el.setAttribute('role','listitem');
      el.tabIndex = 0;
      el.innerHTML = `
        <div class="media"><img src="${p.hero||p.img}" alt="${p.title}"></div>
        <div class="layer" aria-hidden="true"></div>
        <div class="content overlay">
          <div class="title">${p.title}</div>
          <div class="meta">${(p.tags||[]).join(' ‚Ä¢ ')} ‚Ä¢ ${p.cal||''}</div>
          <div class="price">${fmt(p.price)}</div>
        </div>
      `;
      // quick open drawer with Shift+click
      el.addEventListener('click', (ev) => {
        if(ev.shiftKey){ ev.preventDefault(); openDrawer(p.id); }
      });
      // staggered entrance
      setTimeout(()=> el.classList.add('visible'), 70 * idx);
      return el;
    }

    function populateSubway(){
      viewport.innerHTML = '';
      const list = PRODUCTS.slice(0,5);
      list.forEach((p,i)=> viewport.appendChild(createCard(p,i)));
      requestAnimationFrame(updateCenterClasses);
    }

    /* Center detection and classes */
    function getCards(){ return Array.from(viewport.querySelectorAll('.subway-card')); }

    function updateCenterClasses(){
      const cards = getCards();
      if(!cards.length) return;
      const vp = viewport.getBoundingClientRect();
      const cx = vp.left + vp.width/2;
      const arr = cards.map(c => {
        const r = c.getBoundingClientRect();
        return { c, d: Math.abs((r.left + r.width/2) - cx) };
      }).sort((a,b)=>a.d - b.d);

      cards.forEach(c=> c.classList.remove('center','near','far','distant'));
      if(arr[0]) arr[0].c.classList.add('center');
      if(arr[1]) arr[1].c.classList.add('near');
      if(arr[2]) arr[2].c.classList.add('far');
      for(let i=3;i<arr.length;i++) arr[i].c.classList.add('distant');
    }

    /* Scrolling helpers */
    function getCenterIndex(){
      const cards = getCards();
      if(!cards.length) return 0;
      const vp = viewport.getBoundingClientRect();
      const cx = vp.left + vp.width/2;
      let best = { idx:0, d: Infinity };
      cards.forEach((c,i)=>{
        const r = c.getBoundingClientRect();
        const cc = r.left + r.width/2;
        const d = Math.abs(cc - cx);
        if(d < best.d) best = { idx:i, d };
      });
      return best.idx;
    }

    function scrollToIndex(idx, opts = {behavior:'smooth'}) {
      const cards = getCards();
      const card = cards[idx];
      if(!card) return;
      const vpRect = viewport.getBoundingClientRect();
      const cardRect = card.getBoundingClientRect();
      const offset = (cardRect.left + cardRect.width/2) - (vpRect.left + vpRect.width/2);
      viewport.scrollTo({ left: Math.round(viewport.scrollLeft + offset), behavior: opts.behavior });
    }

    function scrollByCard(delta){
      const idx = getCenterIndex();
      const target = Math.min(Math.max(0, idx + delta), getCards().length - 1);
      scrollToIndex(target);
    }

    /* Autoplay (respects reduced motion) */
    let autoplayId = null;
    const AUTOPLAY_MS = 3000;
    const PREFERS_REDUCED = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    function startAutoPlay(){
      if(PREFERS_REDUCED) return;
      stopAutoPlay();
      autoplayId = setInterval(()=> {
        const idx = getCenterIndex();
        const cards = getCards();
        const next = (idx + 1) % cards.length;
        scrollToIndex(next);
      }, AUTOPLAY_MS);
      playBtn && (playBtn.style.display = 'none');
      pauseBtn && (pauseBtn.style.display = '');
    }

    function stopAutoPlay(){
      if(autoplayId) clearInterval(autoplayId);
      autoplayId = null;
      playBtn && (playBtn.style.display = '');
      pauseBtn && (pauseBtn.style.display = 'none');
    }

    /* Hover/focus/pointer interactions */
    function attachInteractions(){
      const cards = getCards();
      cards.forEach((card,i) => {
        card.dataset.index = i;

        card.addEventListener('mouseenter', () => {
          if(navigator.maxTouchPoints && navigator.maxTouchPoints > 0) return;
          card.__hoverTimeout = setTimeout(()=> {
            if(card.__isPointerDown) return;
            scrollToIndex(i);
          }, 160);
        }, { passive:true });

        card.addEventListener('mouseleave', () => {
          if(card.__hoverTimeout){ clearTimeout(card.__hoverTimeout); card.__hoverTimeout = null; }
        }, { passive:true });

        card.addEventListener('focus', () => scrollToIndex(i), { passive:true });

        card.addEventListener('pointerdown', () => { card.__isPointerDown = true; stopAutoPlay(); }, { passive:true });
        card.addEventListener('pointerup', () => { card.__isPointerDown = false; setTimeout(()=> scrollToIndex(getCenterIndex()), 140); }, { passive:true });
      });
    }

    /* Controls and keyboard */
    function wireControls(){
      prevBtn && prevBtn.addEventListener('click', ()=> scrollByCard(-1));
      nextBtn && nextBtn.addEventListener('click', ()=> scrollByCard(1));
      playBtn && playBtn.addEventListener('click', ()=> startAutoPlay());
      pauseBtn && pauseBtn.addEventListener('click', ()=> stopAutoPlay());

      viewport.addEventListener('keydown', (e) => {
        if(e.key === 'ArrowLeft'){ e.preventDefault(); scrollByCard(-1); }
        if(e.key === 'ArrowRight'){ e.preventDefault(); scrollByCard(1); }
      });

      let raf = 0;
      viewport.addEventListener('scroll', () => {
        if(raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(()=> { updateCenterClasses(); raf = 0; });
      }, { passive:true });

      let endTimer = null;
      viewport.addEventListener('scroll', () => {
        if(endTimer) clearTimeout(endTimer);
        endTimer = setTimeout(()=> updateCenterClasses(), 120);
      }, { passive:true });

      window.addEventListener('resize', () => requestAnimationFrame(updateCenterClasses));
    }

    /* Drawer & cart basic integration */
    const CART_KEY = 'site_cart_v1';
    function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY) || '[]'); }catch(e){ return []; } }
    function saveCart(cart){ try{ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }catch(e){} renderCart(); }
    function addToCart(item){
      const cart = loadCart();
      const existing = cart.find(i => i.id === item.id && i.price === item.price);
      if(existing) existing.qty = (existing.qty||1) + (item.qty||1);
      else cart.push(Object.assign({ qty:item.qty||1 }, item));
      saveCart(cart);
    }

    function renderCart(){
      const cart = loadCart();
      const total = cart.reduce((s,i)=> s + (i.price * (i.qty||1)), 0);
      if(!cartWidget) return;
      if(!cart.length){ cartWidget.innerHTML = '<div class="muted" style="padding:14px;text-align:center">Your cart is empty</div>'; cartWidget.classList.remove('hidden'); cartWidget.setAttribute('aria-hidden','false'); return; }
      cartWidget.innerHTML = '<div class="cart-panel"><div class="cart-header"><strong>Cart</strong><button id="clearCart" class="subway-btn">Clear</button></div><div id="cartBody"></div><div style="display:flex;justify-content:space-between;align-items:center"><div>Total <strong>' + fmt(total) + '</strong></div><button id="checkoutBtn" class="subway-btn">Checkout</button></div></div>';
      const cartBody = document.getElementById('cartBody');
      cartBody.innerHTML = '';
      cart.forEach((it, idx) => {
        const row = document.createElement('div');
        row.style.display = 'flex';
        row.style.alignItems = 'center';
        row.style.gap = '8px';
        row.style.padding = '8px';
        row.innerHTML = `<img src="${it.img||''}" alt="${it.title}" style="width:56px;height:40px;object-fit:cover;border-radius:6px"><div style="flex:1"><div style="font-weight:700">${it.title}</div><div class="muted">‚Ç¨${it.price.toFixed(2)} √ó <span class="qty">${it.qty}</span></div></div><div style="display:flex;gap:6px"><button class="subway-btn qty-minus" data-idx="${idx}">‚àí</button><button class="subway-btn qty-plus" data-idx="${idx}">+</button><button class="subway-btn remove" data-idx="${idx}">‚úï</button></div>`;
        cartBody.appendChild(row);
      });
      cartWidget.classList.remove('hidden');
      cartWidget.setAttribute('aria-hidden','false');
    }

    document.addEventListener('click', (e) => {
      const t = e.target;
      if(!t) return;

      if(t.matches('.quick-view')){ openDrawer(t.dataset.id); return; }

      if(t.matches('.add-mini')){
        const id = t.dataset.id;
        const p = PRODUCTS.find(x=> String(x.id) === String(id));
        if(!p) return;
        addToCart({ id: String(p.id), title: p.title, price: p.price, qty:1, img: p.img });
        const prev = t.textContent;
        t.textContent = '‚úì Added';
        t.disabled = true;
        setTimeout(()=> { t.textContent = prev || 'Add'; t.disabled = false; }, 900);
        return;
      }

      if(t.id === 'cartIcon'){ renderCart(); return; }
      if(t.id === 'clearCart'){ localStorage.removeItem(CART_KEY); renderCart(); cartWidget.classList.add('hidden'); cartWidget.setAttribute('aria-hidden','true'); return; }
      if(t.id === 'checkoutBtn'){ alert('Checkout placeholder ‚Äî integrate payment flow'); return; }
      if(t.matches('.qty-plus')){ const idx = +t.dataset.idx; const c = loadCart(); c[idx].qty = (c[idx].qty||1) + 1; saveCart(c); return; }
      if(t.matches('.qty-minus')){ const idx = +t.dataset.idx; const c = loadCart(); c[idx].qty = Math.max(1, (c[idx].qty||1) - 1); saveCart(c); return; }
      if(t.matches('.remove')){ const idx = +t.dataset.idx; const c = loadCart(); c.splice(idx,1); saveCart(c); return; }
    });

    /* Drawer behaviors */
    function openDrawer(id){
      if(!drawer) return;
      const p = PRODUCTS.find(x=> String(x.id) === String(id));
      if(!p) return;
      drawerTitle && (drawerTitle.textContent = p.title);
      drawerMedia && (drawerMedia.innerHTML = `<img src="${p.hero||p.img}" alt="${p.title}">`);
      drawerPrice && (drawerPrice.textContent = fmt(p.price));
      drawerDesc && (drawerDesc.textContent = p.desc || '');
      if(drawerSizes){
        drawerSizes.innerHTML = (p.sizes||[]).map(s=>`<button class="size-pill" data-price="${s.price}">${s.label} ‚Äî ${fmt(s.price)}</button>`).join('');
        const first = drawerSizes.querySelector('.size-pill');
        if(first){ first.classList.add('active'); drawerAdd && (drawerAdd.dataset.price = first.dataset.price); }
        drawerSizes.onclick = (ev) => {
          const b = ev.target.closest && ev.target.closest('.size-pill');
          if(!b) return;
          drawerSizes.querySelectorAll('.size-pill').forEach(x=>x.classList.remove('active'));
          b.classList.add('active');
          drawerPrice && (drawerPrice.textContent = fmt(Number(b.dataset.price)));
          drawerAdd && (drawerAdd.dataset.price = b.dataset.price);
        };
      }
      drawer.dataset.id = p.id;
      drawer.classList.add('open');
      drawer.setAttribute('aria-hidden','false');
      const focusable = drawer.querySelector('button, a, [tabindex]') || drawer;
      focusable && focusable.focus();
    }

    function closeDrawer(){
      if(!drawer) return;
      drawer.classList.remove('open');
      drawer.setAttribute('aria-hidden','true');
    }

    drawerCancel && drawerCancel.addEventListener('click', ()=> { closeDrawer(); drawer.classList.add('closing'); setTimeout(()=> drawer.classList.remove('closing'), 280); });
    drawerClose && drawerClose.addEventListener('click', closeDrawer);
    drawerAdd && drawerAdd.addEventListener('click', () => {
      if(!drawer) return;
      const id = drawer.dataset.id;
      const price = parseFloat(drawerAdd.dataset.price || (drawerPrice?.textContent || '').replace(/[^\d.]/g,'')) || 0;
      addToCart({ id: String(id), title: drawerTitle?.textContent || 'Item', price, qty:1, img: drawerMedia?.querySelector('img')?.src || '' });
      closeDrawer();
    });
    document.addEventListener('keydown', e=> { if(e.key === 'Escape') closeDrawer(); });

    /* Init */
    function init(){
      populateSubway();
      attachInteractions();
      wireControls();
      updateCenterClasses();
      // initial center the middle card
      const cards = getCards();
      const initial = Math.floor(cards.length / 2);
      setTimeout(()=> { scrollToIndex(initial, {behavior:'auto'}); updateCenterClasses(); }, 60);
      if(window.ResizeObserver){
        const ro = new ResizeObserver(()=> requestAnimationFrame(updateCenterClasses));
        ro.observe(viewport);
      }
    }

    if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
    else init();

    // Expose simple API for debug
    window.Subway = { start: startAutoPlay, stop: stopAutoPlay, next: ()=> scrollByCard(1), prev: ()=> scrollByCard(-1), getCenterIndex };
  </script>
</body>
</html>